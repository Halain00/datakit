<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>File (datakit-server.Vfs.File)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">datakit-server</a> &#x00BB; <a href="../index.html">Vfs</a> &#x00BB; File</nav><h1>Module <code>Vfs.File</code></h1><p>File operations.</p><nav class="toc"><ul><li><a href="#basic-constructors">Basic constructors</a></li><li><a href="#k/v-stores.">K/V stores.</a></li><li><a href="#streams">Streams</a></li><li><a href="#errors">Errors</a></li></ul></nav></header><dl><dt class="spec type" id="type-fd"><a href="#type-fd" class="anchor"></a><code><span class="keyword">type</span> fd</code></dt><dd><p>The type for open files, e.g. file descriptors.</p></dd></dl><dl><dt class="spec value" id="val-create_fd"><a href="#val-create_fd" class="anchor"></a><code><span class="keyword">val</span> create_fd : <span>read:<span>(<span>offset:int64</span> <span>&#45;&gt;</span> <span>count:int</span> <span>&#45;&gt;</span> <span>Cstruct.t <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>write:<span>(<span>offset:int64</span> <span>&#45;&gt;</span> Cstruct.t <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-fd">fd</a></code></dt><dd><p>Create an open file object.</p></dd></dl><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <a href="index.html#type-fd">fd</a> <span>&#45;&gt;</span> <span>offset:int64</span> <span>&#45;&gt;</span> <span>count:int</span> <span>&#45;&gt;</span> <span>Cstruct.t <a href="../index.html#type-or_err">or_err</a></span></code></dt><dd><p><code>read f ~offset ~count</code> reads an open file.</p></dd></dl><dl><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : <a href="index.html#type-fd">fd</a> <span>&#45;&gt;</span> <span>offset:int64</span> <span>&#45;&gt;</span> Cstruct.t <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span></code></dt><dd><p><code>write f ~offset</code> writes in a open file.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The type for files.</p></dd></dl><dl><dt class="spec value" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val</span> pp : <span><a href="index.html#type-t">t</a> Fmt.t</span></code></dt><dd><p><code>pp</code> is the pretty-printer for files.</p></dd></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>stat:<span>(unit <span>&#45;&gt;</span> <span><a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>open_:<span>(unit <span>&#45;&gt;</span> <span><a href="index.html#type-fd">fd</a> <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>remove:<span>(unit <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>truncate:<span>(int64 <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>chmod:<span>(<a href="../index.html#type-perm">perm</a> <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>create</code> is the file <code>t</code> such that FIXME.</p></dd></dl><dl><dt class="spec value" id="val-stat"><a href="#val-stat" class="anchor"></a><code><span class="keyword">val</span> stat : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a></span></code></dt><dd><p><code>stat t</code> is <code>t</code>'s metadata.</p></dd></dl><dl><dt class="spec value" id="val-size"><a href="#val-size" class="anchor"></a><code><span class="keyword">val</span> size : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>int64 <a href="../index.html#type-or_err">or_err</a></span></code></dt><dd><p><code>size t</code> is <code>t</code>'s size.</p></dd></dl><dl><dt class="spec value" id="val-open_"><a href="#val-open_" class="anchor"></a><code><span class="keyword">val</span> open_ : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-fd">fd</a> <a href="../index.html#type-or_err">or_err</a></span></code></dt><dd><p><code>open_ t</code> if a file-descriptor for <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-remove"><a href="#val-remove" class="anchor"></a><code><span class="keyword">val</span> remove : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span></code></dt><dd><p><code>remove t</code> removes <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-truncate"><a href="#val-truncate" class="anchor"></a><code><span class="keyword">val</span> truncate : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int64 <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span></code></dt><dd><p><code>truncate t len</code> sets the length of <code>t</code> to <code>len</code>. If the new length is shorter, the file is truncated. If longer, it is padded with zeroes.</p></dd></dl><dl><dt class="spec value" id="val-chmod"><a href="#val-chmod" class="anchor"></a><code><span class="keyword">val</span> chmod : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-perm">perm</a> <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span></code></dt><dd><p><code>chmod t mode</code> changes the mode of <code>t</code>.</p></dd></dl><section><header><h2 id="basic-constructors"><a href="#basic-constructors" class="anchor"></a>Basic constructors</h2></header><dl><dt class="spec value" id="val-ro_of_string"><a href="#val-ro_of_string" class="anchor"></a><code><span class="keyword">val</span> ro_of_string : <span>?&#8288;perm:<a href="../index.html#type-perm">perm</a></span> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>ro_of_string s</code> is the static file containing <code>s</code>.</p></dd></dl><dl><dt class="spec value" id="val-rw_of_string"><a href="#val-rw_of_string" class="anchor"></a><code><span class="keyword">val</span> rw_of_string : string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> * <span>(unit <span>&#45;&gt;</span> string)</span></code></dt><dd><p><code>rw_of_string init</code> is a mutable file that initially contains <code>init</code> and a function which can be called to get the current contents.</p></dd></dl><dl><dt class="spec value" id="val-status"><a href="#val-status" class="anchor"></a><code><span class="keyword">val</span> status : <span>?&#8288;length:<span>(unit <span>&#45;&gt;</span> <span>int Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span>string Lwt.t</span>)</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>status f</code> is the file containing the result of <code>f</code>. <code>f</code> is evaluated everytime the file is open. If <code>length</code> is not set, <code>f</code> will also be called during <code>stat</code> queries.</p></dd></dl><dl><dt class="spec value" id="val-command"><a href="#val-command" class="anchor"></a><code><span class="keyword">val</span> command : <span>?&#8288;init:string</span> <span>&#45;&gt;</span> <span>(string <span>&#45;&gt;</span> <span>string <a href="../index.html#type-or_err">or_err</a></span>)</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>command ?init f</code> is the file containing the result of <code>f</code>. <code>f</code> is evaluated on every write, with the contents of the file as argument. Initially the file contains <code>init</code>.</p></dd></dl></section><section><header><h2 id="k/v-stores."><a href="#k/v-stores." class="anchor"></a>K/V stores.</h2></header><dl><dt class="spec value" id="val-of_kv"><a href="#val-of_kv" class="anchor"></a><code><span class="keyword">val</span> of_kv : <span>read:<span>(unit <span>&#45;&gt;</span> <span><span>Cstruct.t option</span> <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>write:<span>(Cstruct.t <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>stat:<span>(unit <span>&#45;&gt;</span> <span><a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>remove:<span>(unit <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>chmod:<span>(<a href="../index.html#type-perm">perm</a> <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_kv ~read ~write ~remove ~stat</code> interprets values from a k/v store as files. Handles reading and writing regions of the file.</p></dd></dl><dl><dt class="spec value" id="val-of_kvro"><a href="#val-of_kvro" class="anchor"></a><code><span class="keyword">val</span> of_kvro : <span>read:<span>(unit <span>&#45;&gt;</span> <span><span>Cstruct.t option</span> <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <span>stat:<span>(unit <span>&#45;&gt;</span> <span><a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_kvro</code> is similar to <a href="index.html#val-of_kv"><code>of_kv</code></a> but for read-only values.</p></dd></dl><dl><dt class="spec value" id="val-stat_of"><a href="#val-stat_of" class="anchor"></a><code><span class="keyword">val</span> stat_of : <span>read:<span>(unit <span>&#45;&gt;</span> <span><span>Cstruct.t option</span> <a href="../index.html#type-or_err">or_err</a></span>)</span></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><a href="../index.html#type-metadata">metadata</a> <a href="../index.html#type-or_err">or_err</a></span></code></dt><dd><p><code>stat_of ~read</code> makes a <code>stat</code> function from <code>read</code>. The function reads the file to get the length, and reports the type as <code>`Normal</code>.</p></dd></dl></section><section><header><h2 id="streams"><a href="#streams" class="anchor"></a>Streams</h2></header><div class="spec module" id="module-Stream"><a href="#module-Stream" class="anchor"></a><code><span class="keyword">module</span> <a href="Stream/index.html">Stream</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div><dl><dt class="spec value" id="val-of_stream"><a href="#val-of_stream" class="anchor"></a><code><span class="keyword">val</span> of_stream : <span>(unit <span>&#45;&gt;</span> <span><a href="Stream/index.html#type-t">Stream.t</a> Lwt.t</span>)</span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>of_stream s</code> is the file which will be, once opened, similar to the stream <code>s ()</code>.</p></dd></dl></section><section><header><h2 id="errors"><a href="#errors" class="anchor"></a>Errors</h2></header><dl><dt class="spec value" id="val-err_no_entry"><a href="#val-err_no_entry" class="anchor"></a><code><span class="keyword">val</span> err_no_entry : <span><span class="type-var">'a</span> <a href="../index.html#type-or_err">or_err</a></span></code></dt><dt class="spec value" id="val-err_read_only"><a href="#val-err_read_only" class="anchor"></a><code><span class="keyword">val</span> err_read_only : <span><span class="type-var">'a</span> <a href="../index.html#type-or_err">or_err</a></span></code></dt></dl></section></div></body></html>