<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (datakit-github.Datakit_github_conv.Make)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">datakit-github</a> &#x00BB; <a href="../index.html">Datakit_github_conv</a> &#x00BB; Make</nav><h1>Module <code>Datakit_github_conv.Make</code></h1><p>Conversion between GitHub and DataKit states.</p><nav class="toc"><ul><li><a href="#repositories">Repositories</a></li><li><a href="#status">Status</a></li><li><a href="#pull-requests">Pull requests</a></li><li><a href="#git-references">Git References</a></li><li><a href="#elements">Elements</a></li><li><a href="#updates">Updates</a></li><li><a href="#dirty">Dirty</a></li><li><a href="#snapshots-and-diffs">Snapshots and diffs</a></li></ul></nav></header><h3 class="heading">Parameters</h3><ul><li><code><a href="argument-1-DK/index.html">DK</a> : <a href="../../../datakit-client/Datakit_client/index.html#module-type-S">Datakit_client.S</a></code></li></ul><h3 class="heading">Signature</h3><dl><dt class="spec type" id="type-tree"><a href="#type-tree" class="anchor"></a><code><span class="keyword">type</span> tree</code><code> = <a href="argument-1-DK/Tree/index.html#type-t">DK.Tree.t</a></code></dt><dd><p>The type for trees.</p></dd></dl><section><header><h2 id="repositories"><a href="#repositories" class="anchor"></a>Repositories</h2></header><dl><dt class="spec value" id="val-repos"><a href="#val-repos" class="anchor"></a><code><span class="keyword">val</span> repos : <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <span><a href="../../Datakit_github/Repo/index.html#module-Set">Datakit_github.Repo.Set</a>.t Lwt.t</span></code></dt><dd><p><code>repos t</code> is the list of repositories stored in <code>t</code>.</p></dd></dl></section><section><header><h2 id="status"><a href="#status" class="anchor"></a>Status</h2></header><dl><dt class="spec value" id="val-statuses"><a href="#val-statuses" class="anchor"></a><code><span class="keyword">val</span> statuses : <span>?&#8288;commits:<a href="../../Datakit_github/Commit/index.html#module-Set">Datakit_github.Commit.Set</a>.t</span> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <span><a href="../../Datakit_github/Status/index.html#module-Set">Datakit_github.Status.Set</a>.t Lwt.t</span></code></dt><dd><p><code>statuses t</code> is the list of status stored in <code>t</code>.</p></dd></dl></section><section><header><h2 id="pull-requests"><a href="#pull-requests" class="anchor"></a>Pull requests</h2></header><dl><dt class="spec value" id="val-prs"><a href="#val-prs" class="anchor"></a><code><span class="keyword">val</span> prs : <span>?&#8288;repos:<a href="../../Datakit_github/Repo/index.html#module-Set">Datakit_github.Repo.Set</a>.t</span> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <span><a href="../../Datakit_github/PR/index.html#module-Set">Datakit_github.PR.Set</a>.t Lwt.t</span></code></dt><dd><p><code>prs t</code> is the list of pull requests stored in <code>t</code>.</p></dd></dl></section><section><header><h2 id="git-references"><a href="#git-references" class="anchor"></a>Git References</h2></header><dl><dt class="spec value" id="val-refs"><a href="#val-refs" class="anchor"></a><code><span class="keyword">val</span> refs : <span>?&#8288;repos:<a href="../../Datakit_github/Repo/index.html#module-Set">Datakit_github.Repo.Set</a>.t</span> <span>&#45;&gt;</span> <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <span><a href="../../Datakit_github/Ref/index.html#module-Set">Datakit_github.Ref.Set</a>.t Lwt.t</span></code></dt><dd><p><code>refs t</code> is the list of Git references stored in <code>t</code>.</p></dd></dl></section><section><header><h2 id="elements"><a href="#elements" class="anchor"></a>Elements</h2></header><dl><dt class="spec value" id="val-find"><a href="#val-find" class="anchor"></a><code><span class="keyword">val</span> find : <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <a href="../../Datakit_github/Elt/index.html#type-id">Datakit_github.Elt.id</a> <span>&#45;&gt;</span> <span><span><a href="../../Datakit_github/Elt/index.html#type-t">Datakit_github.Elt.t</a> option</span> Lwt.t</span></code></dt><dd><p><code>find t id</code> is the elements with ID <code>id</code> in <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-pr"><a href="#val-pr" class="anchor"></a><code><span class="keyword">val</span> pr : <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <a href="../../Datakit_github/PR/index.html#type-id">Datakit_github.PR.id</a> <span>&#45;&gt;</span> <span><span><a href="../../Datakit_github/PR/index.html#type-t">Datakit_github.PR.t</a> option</span> Lwt.t</span></code></dt><dd><p><code>pr t id</code> is the pull-request with ID <code>id</code>.</p></dd></dl><dl><dt class="spec value" id="val-ref"><a href="#val-ref" class="anchor"></a><code><span class="keyword">val</span> ref : <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <a href="../../Datakit_github/Ref/index.html#type-id">Datakit_github.Ref.id</a> <span>&#45;&gt;</span> <span><span><a href="../../Datakit_github/Ref/index.html#type-t">Datakit_github.Ref.t</a> option</span> Lwt.t</span></code></dt><dd><p><code>ref t id</code> is the Git reference with ID <code>id</code>.</p></dd></dl><dl><dt class="spec value" id="val-status"><a href="#val-status" class="anchor"></a><code><span class="keyword">val</span> status : <a href="index.html#type-tree">tree</a> <span>&#45;&gt;</span> <a href="../../Datakit_github/Status/index.html#type-id">Datakit_github.Status.id</a> <span>&#45;&gt;</span> <span><span><a href="../../Datakit_github/Status/index.html#type-t">Datakit_github.Status.t</a> option</span> Lwt.t</span></code></dt><dd><p><code>status t id</code> is the build status with ID <code>id</code>.</p></dd></dl></section><section><header><h2 id="updates"><a href="#updates" class="anchor"></a>Updates</h2></header><dl><dt class="spec value" id="val-update_elt"><a href="#val-update_elt" class="anchor"></a><code><span class="keyword">val</span> update_elt : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span>&#45;&gt;</span> <a href="../../Datakit_github/Elt/index.html#type-t">Datakit_github.Elt.t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>update_elt t e</code> updates the element <code>e</code> in the transaction <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-remove_elt"><a href="#val-remove_elt" class="anchor"></a><code><span class="keyword">val</span> remove_elt : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span>&#45;&gt;</span> <a href="../../Datakit_github/Elt/index.html#type-id">Datakit_github.Elt.id</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>remove_elt t e</code> removes the element <code>e</code> in the transaction <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-update_event"><a href="#val-update_event" class="anchor"></a><code><span class="keyword">val</span> update_event : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span>&#45;&gt;</span> <a href="../../Datakit_github/Event/index.html#type-t">Datakit_github.Event.t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>update_event t e</code> applies the (webhook) event <code>e</code> to the transaction <code>t</code>.</p></dd></dl></section><section><header><h2 id="dirty"><a href="#dirty" class="anchor"></a>Dirty</h2></header><dl><dt class="spec type" id="type-dirty"><a href="#type-dirty" class="anchor"></a><code><span class="keyword">type</span> dirty</code><code> = <a href="../../Datakit_github/Elt/index.html#module-IdSet">Datakit_github.Elt.IdSet</a>.t</code></dt><dd><p>The type for dirty elements.</p></dd></dl><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The type for filesystem snapshots.</p></dd></dl><dl><dt class="spec value" id="val-stain"><a href="#val-stain" class="anchor"></a><code><span class="keyword">val</span> stain : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span>&#45;&gt;</span> <a href="index.html#type-dirty">dirty</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>stain tr d</code> makes all the elements in <code>d</code> dirty.</p></dd></dl><dl><dt class="spec value" id="val-clean"><a href="#val-clean" class="anchor"></a><code><span class="keyword">val</span> clean : <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span>&#45;&gt;</span> <a href="index.html#type-dirty">dirty</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>clean t d</code> removes <code>d</code> from the list of dirty elements in <code>t</code>.</p></dd></dl><dl><dt class="spec value" id="val-dirty"><a href="#val-dirty" class="anchor"></a><code><span class="keyword">val</span> dirty : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-dirty">dirty</a></code></dt><dd><p><code>dirty t</code> is the collection of dirty elements in <code>t</code>.</p></dd></dl></section><section><header><h2 id="snapshots-and-diffs"><a href="#snapshots-and-diffs" class="anchor"></a>Snapshots and diffs</h2></header><dl><dt class="spec value" id="val-snapshot"><a href="#val-snapshot" class="anchor"></a><code><span class="keyword">val</span> snapshot : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../../Datakit_github/Snapshot/index.html#type-t">Datakit_github.Snapshot.t</a></code></dt><dd><p><code>snapshot t</code> is <code>t</code>'s in-memory snapshot.</p></dd></dl><dl><dt class="spec value" id="val-head"><a href="#val-head" class="anchor"></a><code><span class="keyword">val</span> head : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="argument-1-DK/Commit/index.html#type-t">DK.Commit.t</a></code></dt><dd><p><code>head t</code> is <code>t</code>'s head.</p></dd></dl><dl><dt class="spec value" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span class="keyword">val</span> pp : <span><a href="index.html#type-t">t</a> Fmt.t</span></code></dt><dd><p><code>pp</code> is the pretty-printer for <a href="index.html#val-snapshot"><code>snapshot</code></a> values.</p></dd></dl><dl><dt class="spec value" id="val-diff"><a href="#val-diff" class="anchor"></a><code><span class="keyword">val</span> diff : <a href="argument-1-DK/Commit/index.html#type-t">DK.Commit.t</a> <span>&#45;&gt;</span> <a href="argument-1-DK/Commit/index.html#type-t">DK.Commit.t</a> <span>&#45;&gt;</span> <span><span>(<a href="../../Datakit_github/Diff/index.html#type-t">Datakit_github.Diff.t</a> * <a href="index.html#type-dirty">dirty</a>)</span> Lwt.t</span></code></dt><dd><p><code>diff x y</code> computes the difference between the commits <code>x</code> and <code>y</code>.</p></dd></dl><dl><dt class="spec value" id="val-of_branch"><a href="#val-of_branch" class="anchor"></a><code><span class="keyword">val</span> of_branch : <span>debug:string</span> <span>&#45;&gt;</span> <span>?&#8288;old:<a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="argument-1-DK/Branch/index.html#type-t">DK.Branch.t</a> <span>&#45;&gt;</span> <span><span>(<a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> * <a href="index.html#type-t">t</a>)</span> Lwt.t</span></code></dt><dd><p><code>snapshot dbg ?old b</code> is a pair <code>(t, s)</code> where <code>s</code> is a snapshot of the branch <code>b</code> and a <code>t</code> is a transaction started on <code>s</code>'s commit. Note: this is expensive, so try to provide a (recent) <code>old</code> snapshot if possible. In that case, the difference between the two snapshot's commits will be computed and only the minimal number of filesystem access will be performed to compute the new snapshot by updating the old one.</p></dd></dl><dl><dt class="spec value" id="val-of_commit"><a href="#val-of_commit" class="anchor"></a><code><span class="keyword">val</span> of_commit : <span>debug:string</span> <span>&#45;&gt;</span> <span>?&#8288;old:<a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <a href="argument-1-DK/Commit/index.html#type-t">DK.Commit.t</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> Lwt.t</span></code></dt><dd><p>Same as <a href="index.html#val-of_branch"><code>of_branch</code></a> but does not allow to update the underlying store.</p></dd></dl><dl><dt class="spec value" id="val-apply"><a href="#val-apply" class="anchor"></a><code><span class="keyword">val</span> apply : <span>debug:string</span> <span>&#45;&gt;</span> <a href="../../Datakit_github/Diff/index.html#type-t">Datakit_github.Diff.t</a> <span>&#45;&gt;</span> <a href="argument-1-DK/Transaction/index.html#type-t">DK.Transaction.t</a> <span>&#45;&gt;</span> <span>bool Lwt.t</span></code></dt><dd><p><code>apply d t</code> applies the snapshot diff <code>d</code> into the datakit transaction <code>t</code>. Returns <code>true</code> iff the undelying datakit state has changed.</p></dd></dl></section></div></body></html>