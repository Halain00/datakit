<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Git (datakit-ci.Datakit_ci.Git)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../../index.html">datakit-ci</a> &#x00BB; <a href="../index.html">Datakit_ci</a> &#x00BB; Git</nav><h1>Module <code>Datakit_ci.Git</code></h1><nav class="toc"><ul><li><a href="#git">Git Manipulation</a></li></ul></nav></header><section><header><h2 id="git"><a href="#git" class="anchor"></a>Git Manipulation</h2><p>The <code>Git</code> plugin provides Git-related combinators. It defines types for <a href="index.html#type-t"><span>local Git repositories</span></a>, <a href="index.html#type-commit"><span>Git commits</span></a> inside these repositories and <a href="index.html#type-command"><span>shell command</span></a> to run on a given checkout.</p></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt><dd><p>The type for local non-bare git working directory (with a .git sub-directory).</p></dd></dl><dl><dt class="spec value" id="val-v"><a href="#val-v" class="anchor"></a><code><span class="keyword">val</span> v : ?&#8288;remote:string <span>&#45;&gt;</span> logs:<a href="../Live_log/index.html#type-manager">Live_log.manager</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>v ~remote ~logs dir</code> is the local Git repository at <code>dir</code>. If <code>dir</code> does not exist, it is created by <code>git clone remote</code>. If <code>remote</code> is not given and <code>dir</code> does not exist, an exception is raised.</p></dd></dl><dl><dt class="spec type" id="type-commit"><a href="#type-commit" class="anchor"></a><code><span class="keyword">type</span> commit</code></dt><dd><p>The type for Git commits.</p></dd></dl><dl><dt class="spec value" id="val-hash"><a href="#val-hash" class="anchor"></a><code><span class="keyword">val</span> hash : <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> string</code></dt><dd><p><code>hash c</code> is <code>c</code>'s hash.</p></dd></dl><dl><dt class="spec value" id="val-is_after"><a href="#val-is_after" class="anchor"></a><code><span class="keyword">val</span> is_after : old:string <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> bool Lwt.t</code></dt><dd><p><code>is_after ~old c</code> is true iff <code>old</code> appears in the history of <code>c</code>.</p></dd></dl><dl><dt class="spec value" id="val-fetch_head"><a href="#val-fetch_head" class="anchor"></a><code><span class="keyword">val</span> fetch_head : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../Target/index.html#type-t">Target.t</a> <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <a href="../Term/index.html#type-t">Term.t</a></code></dt><dd><p><code>fetch_head t target</code> evaluates to a local branch in <code>t</code> with a copy of <code>target</code>'s head commit (downloading it first if needed).</p></dd></dl><dl><dt class="spec value" id="val-with_checkout"><a href="#val-with_checkout" class="anchor"></a><code><span class="keyword">val</span> with_checkout : log:<a href="../Live_log/index.html#type-t">Live_log.t</a> <span>&#45;&gt;</span> job_id:<a href="../index.html#type-job_id">job_id</a> <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> <span class="type-var">'a</span> Lwt.t) <span>&#45;&gt;</span> <span class="type-var">'a</span> Lwt.t</code></dt><dd><p><code>with_checkout ~log ~job_id commit fn</code> is <code>fn path</code>, where <code>path</code> is the path of a local checkout of <code>commit</code>. <code>path</code> must not be used after <code>fn</code>'s thread terminates. The directory is locked while <code>fn</code> runs with <code>job_id</code> displayed to show why it is busy.</p></dd></dl><dl><dt class="spec value" id="val-with_clone"><a href="#val-with_clone" class="anchor"></a><code><span class="keyword">val</span> with_clone : log:<a href="../Live_log/index.html#type-t">Live_log.t</a> <span>&#45;&gt;</span> job_id:<a href="../index.html#type-job_id">job_id</a> <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> (string <span>&#45;&gt;</span> <span class="type-var">'a</span> Lwt.t) <span>&#45;&gt;</span> <span class="type-var">'a</span> Lwt.t</code></dt><dd><p><code>with_clone</code> is similar to <code>with_checkout</code> but clones the repository to a temporary directory first. This means that the repository does not need to be locked while the callback function runs.</p></dd></dl><dl><dt class="spec type" id="type-command"><a href="#type-command" class="anchor"></a><code><span class="keyword">type</span> command</code></dt><dd><p>A cache of executions of a shell command.</p></dd></dl><dl><dt class="spec value" id="val-command"><a href="#val-command" class="anchor"></a><code><span class="keyword">val</span> command : logs:<a href="../Live_log/index.html#type-manager">Live_log.manager</a> <span>&#45;&gt;</span> timeout:float <span>&#45;&gt;</span> label:string <span>&#45;&gt;</span> clone:bool <span>&#45;&gt;</span> string array list <span>&#45;&gt;</span> <a href="index.html#type-command">command</a></code></dt><dd><p><code>command ~logs ~timeout ~label ~clone cmds</code> is a caching executor of <code>cmds</code>, which caches results in a branch whose name includes <code>label</code>. The command will be terminated if it exceeds <code>timeout</code> seconds. If <code>clone</code> is set then <code>with_clone</code> is used rather than <code>with_checkout</code>. Note: every command must have a unique label!</p></dd></dl><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val</span> run : <a href="index.html#type-command">command</a> <span>&#45;&gt;</span> <a href="index.html#type-commit">commit</a> <span>&#45;&gt;</span> unit <a href="../Term/index.html#type-t">Term.t</a></code></dt><dd><p><code>run cmd commit</code> succeeds if running <code>cmd</code> in a checkout of <code>commit</code> returns an exit status of zero.</p></dd></dl></section></div></body></html>